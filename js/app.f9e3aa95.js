(function(t){function e(e){for(var i,r,o=e[0],c=e[1],u=e[2],h=0,m=[];h<o.length;h++)r=o[h],a[r]&&m.push(a[r][0]),a[r]=0;for(i in c)Object.prototype.hasOwnProperty.call(c,i)&&(t[i]=c[i]);l&&l(e);while(m.length)m.shift()();return s.push.apply(s,u||[]),n()}function n(){for(var t,e=0;e<s.length;e++){for(var n=s[e],i=!0,o=1;o<n.length;o++){var c=n[o];0!==a[c]&&(i=!1)}i&&(s.splice(e--,1),t=r(r.s=n[0]))}return t}var i={},a={app:0},s=[];function r(e){if(i[e])return i[e].exports;var n=i[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=t,r.c=i,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)r.d(n,i,function(e){return t[e]}.bind(null,i));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="/";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],c=o.push.bind(o);o.push=e,o=o.slice();for(var u=0;u<o.length;u++)e(o[u]);var l=c;s.push([0,"chunk-vendors"]),n()})({0:function(t,e,n){t.exports=n("56d7")},"0a27":function(t,e,n){},2791:function(t,e,n){"use strict";var i=n("0a27"),a=n.n(i);a.a},2856:function(t,e,n){},"2e06":function(t,e,n){"use strict";var i=n("84bf"),a=n.n(i);a.a},"43da":function(t,e,n){"use strict";var i=n("7a2b"),a=n.n(i);a.a},"56d7":function(t,e,n){"use strict";n.r(e);n("cadf"),n("551c"),n("097d");var i=n("2b0e"),a=(n("b12e"),n("2f62"));i["a"].use(a["a"]);var s=new a["a"].Store({state:{videoStream:null,picture:null},mutations:{setVideoStream:function(t,e){t.videoStream=e.stream},setPicture:function(t,e){t.picture=e.picture},clearPicture:function(t){t.picture=null}},actions:{setVideoStream:function(t,e){t.commit({type:"setVideoStream",stream:e})},setPicture:function(t,e){t.commit({type:"setPicture",picture:e})},flashPicture:function(t,e){t.commit({type:"setPicture",picture:e}),setTimeout(function(){t.commit({type:"clearPicture"})},500)},clearPicture:function(t){t.commit({type:"clearPicture"})}}}),r=s,o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"app"}},[t.stream?t._e():n("TitleView"),n("CameraView",{attrs:{stream:t.stream}}),n("ResultView",{attrs:{picture:t.picture}})],1)},c=[],u=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"TitleView"},[n("h1",[t._v("Boon")]),n("h2",[t._v("Web技術だけでカメラアプリをつくる話")]),t._m(0),n("button",{on:{click:t.onClickStart}},[t._v("はじめる")])])},l=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("p",[t._v("\n    このアプリはブラウザの機能でカメラアプリっぽいものを作ってみるデモです。"),n("br"),t._v("\n    カメラの権限を要求するため、最新のChrome/Safariをご利用ください。"),n("br"),n("a",{attrs:{href:"https://github.com/rutan/boon",target:"_blank"}},[t._v("GitHub: rutan/boon")])])}],h={name:"TitleView",props:{},data:function(){return{}},methods:{onClickStart:function(t){var e=this;t.preventDefault(),navigator.mediaDevices.getUserMedia({audio:!1,video:{facingMode:{ideal:"environment"}}}).then(function(t){e.$store.dispatch("setVideoStream",t)}).catch(function(t){console.error("error",t)})}}},m=h,v=(n("2791"),n("2877")),d=Object(v["a"])(m,u,l,!1,null,"5d88dd40",null);d.options.__file="TitleView.vue";var f=d.exports,p=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"CameraView",on:{click:t.onClick}},[n("video",{staticClass:"CameraView__video",attrs:{playsinline:"",autoplay:"",muted:""},domProps:{muted:!0}}),n("canvas",{staticClass:"CameraView__subCanvas"}),n("canvas",{staticClass:"CameraView__mainCanvas"}),n("button",{staticClass:"CameraView__takeButton",attrs:{href:"#"},on:{click:t.onShotSubmit}},[n("i",{staticClass:"icon ion-md-camera",attrs:{title:"take photo"}})]),t.isLoading?n("div",{staticClass:"CameraView__Loading"},[n("Loader")],1):t._e()])},C=[],b=n("2440"),_=n.n(b),g=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"Loader"},[t._v("Loading...")])},w=[],E={name:"Loader"},y=E,V=(n("43da"),Object(v["a"])(y,g,w,!1,null,"4c016e58",null));V.options.__file="Loader.vue";var x=V.exports,k={name:"CameraView",props:["stream"],components:{Loader:x},data:function(){return{isDead:!1,isLoading:!1,videoElement:null,subCanvasElement:null,subCanvasContext:null,mainCanvasElement:null,mainCanvasContext:null}},watch:{stream:function(t,e){this.isLoading=!0,this.videoElement.srcObject=t,e||this.refreshCanvas()}},mounted:function(){this.videoElement=this.$el.querySelector(".CameraView__video"),this.subCanvasElement=this.$el.querySelector(".CameraView__subCanvas"),this.subCanvasContext=this.subCanvasElement.getContext("2d"),this.mainCanvasElement=this.$el.querySelector(".CameraView__mainCanvas"),this.mainCanvasContext=this.mainCanvasElement.getContext("2d")},beforeDestroy:function(){this.isDead=!0},methods:{refreshCanvas:function(){var t=this;if(!this.isDead){if(this.videoElement.videoWidth>0){this.isLoading=!1,this.mainCanvasElement.width=this.videoElement.videoWidth,this.mainCanvasElement.height=this.videoElement.videoHeight,this.mainCanvasContext.drawImage(this.videoElement,0,0),this.subCanvasElement.width=this.mainCanvasElement.width/3,this.subCanvasElement.height=this.mainCanvasElement.height/3,this.subCanvasContext.drawImage(this.mainCanvasElement,0,0,this.mainCanvasElement.width,this.mainCanvasElement.height,0,0,this.subCanvasElement.width,this.subCanvasElement.height);var e=this.$el.getBoundingClientRect(),n=Math.min(e.width/this.mainCanvasElement.width,e.height/this.mainCanvasElement.height);this.mainCanvasElement.style.width="".concat(this.mainCanvasElement.width*n,"px"),this.mainCanvasElement.style.height="".concat(this.mainCanvasElement.height*n,"px");var i=1.1*Math.max(e.width/this.subCanvasElement.width,e.height/this.subCanvasElement.height),a=this.subCanvasElement.width*i,s=this.subCanvasElement.height*i;this.subCanvasElement.style.left="".concat((e.width-a)/2,"px"),this.subCanvasElement.style.top="".concat((e.height-s)/2,"px"),this.subCanvasElement.style.width="".concat(a,"px"),this.subCanvasElement.style.height="".concat(s,"px")}requestAnimationFrame(function(){return t.refreshCanvas()})}},onClick:function(){this.videoElement.play()},onShotSubmit:function(t){t.preventDefault();var e=this.mainCanvasElement.toDataURL("image/jpeg",.9);/iP(hone|ad|od)/.test(navigator.userAgent)?this.$store.dispatch("setPicture",e):(this.$store.dispatch("flashPicture",e),this.mainCanvasElement.toBlob(function(t){_.a.saveAs(t,"".concat(Date.now(),".jpg"))}))}}},P=k,S=(n("dbce"),Object(v["a"])(P,p,C,!1,null,"2af7d07d",null));S.options.__file="CameraView.vue";var j=S.exports,$=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("transition",{attrs:{name:"take-photo"}},[t.picture?n("div",{staticClass:"ResultView"},[n("a",{staticClass:"ResultView__Photo",style:{"background-image":"url("+t.picture+")"},attrs:{href:t.picture,download:"picture.jpg",target:"_blank"},on:{click:t.onClickPhoto}})]):t._e()])},O=[],L={name:"ResultView",props:["picture"],methods:{onClickPhoto:function(){this.$store.dispatch("clearPicture")}}},D=L,T=(n("2e06"),Object(v["a"])(D,$,O,!1,null,"30d01aa0",null));T.options.__file="ResultView.vue";var M=T.exports,R={name:"app",components:{TitleView:f,CameraView:j,ResultView:M},computed:{stream:function(){return this.$store.state.videoStream},picture:function(){return this.$store.state.picture}}},W=R,q=(n("5c0b"),Object(v["a"])(W,o,c,!1,null,null,null));q.options.__file="App.vue";var A=q.exports;i["a"].config.productionTip=!1,"serviceWorker"in navigator&&window.addEventListener("load",function(){navigator.serviceWorker.register("service-worker.js").then(function(t){console.log("register service worker",t)}).catch(function(t){console.error(t)})}),function(){new i["a"]({store:r,render:function(t){return t(A)}}).$mount("#app")}()},"5c0b":function(t,e,n){"use strict";var i=n("2856"),a=n.n(i);a.a},"7a2b":function(t,e,n){},"84bf":function(t,e,n){},abc2:function(t,e,n){},dbce:function(t,e,n){"use strict";var i=n("abc2"),a=n.n(i);a.a}});
//# sourceMappingURL=app.f9e3aa95.js.map